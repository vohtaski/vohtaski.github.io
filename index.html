<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="HandheldFriendly" content="true" />

        <style>
            body {
                padding-top: 70px;
                touch-action: none;
            }
            .table-style {
                vertical-align: middle;
                width: 100%;
                border-spacing: 10px;
                border-collapse: separate;
                height: 100%;
            }

            .cell {
                border-radius: 10px;
                text-align: center;
                font-weight: bold;
                font-size: 1.4vw;
                display: table-cell;
                max-width: 0px;
                max-height: 0px;
            }
            .cell-inrevealed {
                border: 2px dotted black;
            }
            .cell-inrevealed:hover {
                border: 2px solid black;
                cursor: pointer;
            }
            .cell-revealed {
                border: 2px solid black;
                cursor: auto;
            }
            .cell-red {
                background: #FFCCCC;
            }
            .cell-blue {
                background: #99CCFF;
            }
            .cell-neutral {
                background: #eeeeee;
            }
            .cell-end {
                background: black;
                color: white;
            }
            .red-stats {
                color: red;
            }
            .blue-stats {
                color: blue;
            }
            .cell-strike {
                opacity: 0.2;
            }


            .recommend-box {
                display: table-cell;
                max-height: 0px;
                max-width: 0px;
                min-width: 100%;
                overflow-y: scroll;
                text-align: center;
                border: 2px solid black;
                border-radius: 10px;
                line-height: 1.2;
                font-size: 1rem;
            }
            @media (max-width: 768px) {
                .recommend-box {
                    font-size: 0.7rem;
                }

            }

            @media (max-width: 992px) {
                /* this fix from 2017 still works! */
                nav.navbar.fixed-top {
                    max-height:100%;
                    overflow-y:auto;
                }
            }

            @media (min-width: 768px) {
                .wide-non-mobile {
                    min-width: 25rem;
                }
            }

        </style>
    </head>
    <body>
        <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <span class="navbar-brand">Words</span>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu" aria-controls="menu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="menu">
                <!-- navigation buttons -->
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item"><a href='#' class="nav-link" data-toggle="modal" data-target="#about-modal">About</a></li>
                    <li id="spymaster-li"
                        class="nav-item"
                        data-toggle="tooltip"
                        data-placement="bottom"
                        title="Display the colors of all tiles.">
                        <a class="nav-link" href="#" id="spymaster">Spymaster</a>
                    </li>
                    <!-- spy assistant  -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Spy Assistant
                        </a>
                        <div class="dropdown-menu text-muted wide-non-mobile">
                            <div class="form-group" id="recommend-lang-warning">
                                <div class="alert alert-warning" role="alert">
                                    Currently only works for english.
                                </div>
                            </div>
                            <div class="form-group d-block d-sm-none" id="recommend-lang-warning">
                                <div class="alert alert-warning" role="alert">
                                    Currently does not work on portrait mode. Flip your phone.
                                </div>
                            </div>
                            <div id="intro-recommend">
                                <form class="px-4 py-1">
                                    <div class="form-group text-justify">
                                        <small>Automated tool to recommend Spymaster clues. It works best towards endgame. It is based on the <a href="https://nlp.stanford.edu/projects/glove/">glove vectors</a>. This specific application was inspired by a <a href="https://jsomers.net/glove-codenames/">blog post</a> that I saw on hacker news.</small>
                                    </div>
                                    <div class="form-group text-center">
                                        <button class="btn btn-primary" id="enable-recommend">Enable</button>
                                    </div>
                                </form>
                            </div>
                            <div id="recommend-settings">
                                <h6 class="dropdown-header">Spy Assistant Settings</h6>

                                <form class="px-4 py-3">
                                    <div class="form-group">
                                        <label for="risk">
                                            Risk tolerance</br>
                                            <small>The number of bad words that are ignored when coming up with clues. Zeros words is the safest option, but might result in more awkward clues.</small>
                                        </label>
                                        <select class="form-control" id="risk">
                                            <option value="0">zero words</option>
                                            <option value="1">one word</option>
                                            <option value="2">two words</option>
                                            <option value="3">three words</option>
                                            <option value="allbutblack">all words (no black)</option>
                                            <option value="all">all words (including black)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="num-guesses">
                                            Target Words</br>
                                            <small>Number of words that the assistant will try to hint at. The larger the number the harder is it to come up with a sensible clue.</small>
                                        </label>
                                        <select class="form-control" id="num-guesses">
                                            <option value="1">one word</option>
                                            <option value="2">two words</option>
                                            <option value="3">three words</option>
                                            <option value="4">four words</option>
                                            <option value="5">five words</option>
                                        </select>
                                    </div>
                                    <div class="form-group text-center">
                                        <button class="btn btn-light" id="disable-recommend">Disable</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </li>
                    <!-- reset  -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Reset
                        </a>
                        <div class="dropdown-menu">
                          <a class="dropdown-item reset-button" href="#" data-language="en">English</a>
                          <a class="dropdown-item reset-button" href="#" data-language="pl">Polish</a>
                        </div>
                    </li>
                    <li class="nav-item"><a href='#' class="nav-link" id="fullscreen">Fullscreen</a></li>

                </ul>
                <div class="nav-text">
                    <span
                       style="color:red"
                       data-toggle="tooltip"
                       data-placement="bottom"
                       title="Number of red tiles that weren't discovered yet.">
                       Red left: <span id="red-left"></span>
                    </span>
                    &nbsp;
                    <span
                       style="color:blue"
                       data-toggle="tooltip"
                       data-placement="bottom"
                       align="right"
                       title="Number of blue tiles that weren't discovered yet.">
                       Blue left: <span id="blue-left"></span>
                    </span>
                    &nbsp;
                    &nbsp;
                </div>
                <!-- seed input -->
                <form class="form-inline my-2 my-lg-0">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">seed</span>
                        </div>
                        <input class="form-control" type="text" class="form-control" id="seed" placeholder="seed"  data-toggle="tooltip" data-placement="bottom" title="Type this on a different device to get the same game">
                    </div>
                </form>

            </div>
        </nav>
        <div class="modal fade" id="about-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">About Words</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Simple website to keep track on a codenames game.</p>

                        <p>On laptops you need to <b>double-click</b> the words to select them.</p>

                        <p>Check out <i>Spy assistant</i> tab for an automated tool to recommend spymaster clues. It works best towards endgame.</p>
                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-info" href="https://en.wikipedia.org/wiki/Codenames_(board_game)">Rules</a>
                        <a class="btn btn-info" href="https://github.com/siemanko/words/">Source</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="container" style="height: 100%; display:flex; flex-direction:column;">
            <div class="row" style="flex: 1.0">
                <div class="col-3 col-lg-2 collapse d-none d-sm-block" id="recommend">
                    <table class="table-style">
                        <tr>
                            <td class="recommend-box align-middle">
                                <div height="100%">
                                    <div id="recommend-blue-loader" class="spinner-grow spinner-grow-sm align-middle text-primary" role="status"></div>
                                    <font color="#77AAFF"><div id="recommend-blue"></div></font>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="recommend-box align-middle">
                                <div height="100%">
                                    <div id="recommend-red-loader" class="spinner-grow spinner-grow-sm align-middle text-danger" role="status"></div>
                                    <font color="#FF8888"><div id="recommend-red"></div></font>
                                </div>
                            </td>
                        </tr>
                    </table >

                </div>
                <div class="col" id="game"></div>
            </div>
        </div>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/1.4.0/tf.min.js" integrity="sha256-0xpIbQVMu7ekp6wgrZGYe6q4myjGVdLTlFjcV1sk2Tg=" crossorigin="anonymous"></script>
        <script src="recommend/localStorageDB.js"></script>
        <script src="seeded_shuffle.js"></script>
        <script src="recommend/recommend.js"></script>
        <script>
            var game = {};
            game.num_rows = 5;
            game.num_cols = 5;
            game.words = [];
            game.revealed = [];
            game.allrevealed = false;
            game.type  = []
            game.error = null;
            game.show_recommend = false;
            game.risk = "0";
            game.num_guesses = "3";

            var polish_words = ["afryka", "amazonka", "ambasada", "ambulans", "ameryka", "anglia", "anioł", "antarktyka", "atlantyda", "australia", "awaria", "aztek", "babka", "bal", "bank", "bar", "basen", "bawełna", "bałwan", "beczka", "belka", "berlin", "bermudy", "bicz", "blok", "bomba", "budowa", "but", "butelka", "bąk", "cebula", "centaur", "centrum", "chiny", "chochlik", "choroba", "ciało", "cień", "czapa", "czar", "czas", "czekolada", "czujka", "dania", "diament", "dinozaur", "dno", "doktor", "donice", "drzewo", "duch", "dusza", "dwór", "dywan", "dzień", "dziobak", "dziura", "dzięcioł", "dzwon", "egipt", "ekran", "europa", "fala", "fartuch", "feniks", "figura", "film", "flet", "foka", "francja", "francuz", "funt", "gaz", "geniusz", "gigant", "gnat", "gniazdko", "golf", "gotyk", "gołąb", "gra", "grabarz", "gracja", "grecja", "groszek", "grzmot", "grzyb", "guma", "guzik", "gwiazda", "góra", "gładki", "głowa", "hak", "helikopter", "himalaje", "holender", "hollywood", "hotel", "humor", "igła", "jabłko", "jagoda", "jaja", "jatka", "jednorożec", "jowisz", "język", "kaczor", "kalosz", "kamień", "kangur", "kaptur", "karawan", "kasa", "kasyno", "kciuk", "keczup", "kiwi", "klamka", "klatka", "klawisz", "klucz", "kod", "kolec", "komórka", "konar", "koncert", "kontakt", "kontrakt", "korona", "korzenie", "kostium", "kot", "kozioł", "koło", "koń", "kościół", "kość", "kraków", "krasnal", "krata", "kret", "kropka", "krzesło", "krzyż", "król", "królik", "królowa", "krówka", "kręgi", "księżniczka", "księżyc", "kucharz", "kwadrat", "lakier", "las", "laser", "laska", "lew", "limuzyna", "lina", "lina", "lis", "loch ness", "lody", "londyn", "lot", "lud", "maj", "maks", "mamut", "marchew", "masa", "materiał", "meksyk", "merkury", "miedź", "mikroskop", "milioner", "mistrz", "miód", "model", "moskwa", "most", "mucha", "mur", "muszla", "mysz", "napad", "nauczyciel", "naukowiec", "nektar", "niebo", "niedźwiedź", "niemcy", "ninja", "nić", "noc", "noga", "nora", "nos", "nowy jork", "nurek", "nóż", "obcy", "obsada", "ogier", "ogień", "ogon", "oko", "olej", "olimp", "oliwa", "opera", "opoka", "organy", "orzech", "orzeł", "ośmiornica", "pająk", "paleta", "paluszki", "pan", "papier", "pas", "pasta", "pazur", "pekin", "perła", "pielęgniarka", "pierścień", "pies", "pilot", "pingwin", "piramida", "pirat", "pistolet", "placek", "plastik", "plaża", "plik", "pochodnia", "pociecha", "pociąg", "poczta", "podkowa", "podkład", "pojazd", "pokrywka", "pole", "policja", "polska", "port", "powietrze", "połączenie", "praca", "prawnik", "prawo", "promień", "przewodnik", "pudło", "punkt", "pupil", "pustka", "północ", "płot", "płyta", "rak", "rakieta", "rama", "rekin", "rewolucja", "robak", "robot", "ruda", "rura", "ryba", "rycerz", "rzut", "rzym", "rząd", "rzęsa", "róg", "róża", "ręka", "rękawica", "samochód", "samolot", "satelita", "saturn", "serce", "siano", "siekacz", "sieć", "silnik", "siła", "skorpion", "skorupa", "smok", "soczewka", "sokół", "spadek", "spadochron", "splot", "stadion", "stan", "statek", "stopa", "stopień", "stołek", "strona", "strumień", "strzał", "stół", "sukienka", "superbohater", "szafa", "szczyt", "szczęście", "szekspir", "szkocja", "szkoła", "szkło", "szmugiel", "sznur", "szpieg", "szpilka", "szpital", "sztuka", "słup", "tablica", "talerz", "talia", "taniec", "tchórz", "teatr", "teleskop", "toaleta", "tokio", "torebka", "trawa", "trucizna", "truteń", "trójkąt", "trąba", "tuba", "tusz", "tusza", "ucho", "usta", "wachlarz", "waga", "waszyngton", "wiatr", "widelec", "wiedźma", "wieloryb", "wieża", "wieżowiec", "wiosna", "wkład", "woda", "wojna", "wstęp", "wybuch", "wydech", "wąż", "zamek", "zebra", "zespół", "zieleń", "ziemia", "zmiana", "zmywacz", "znak", "zwoje", "ząb", "złodziej", "złoto", "ława", "łożysko", "łuk", "łódź", "ślimak", "śmierć", "śnieg", "świerszcz", "świnia", "żabka", "żebro", "żelazo", "żołnierz", "żubr", "żuk", "żuraw", "życie"];
            var english_words = ["people", "history", "way", "art", "world", "information", "map", "two", "family", "government", "health", "system", "computer", "meat", "year", "thanks", "music", "person", "reading", "method", "data", "food", "understanding", "theory", "law", "bird", "literature", "problem", "software", "control", "knowledge", "power", "ability", "economics", "love", "internet", "television", "science", "library", "nature", "fact", "product", "idea", "temperature", "investment", "area", "society", "activity", "story", "industry", "media", "thing", "oven", "community", "definition", "safety", "quality", "development", "language", "management", "player", "variety", "video", "week", "security", "country", "exam", "movie", "organization", "equipment", "physics", "analysis", "policy", "series", "thought", "basis", "boyfriend", "direction", "strategy", "technology", "army", "camera", "freedom", "paper", "environment", "child", "instance", "month", "truth", "marketing", "university", "writing", "article", "department", "difference", "goal", "news", "audience", "fishing", "growth", "income", "marriage", "user", "combination", "failure", "meaning", "medicine", "philosophy", "teacher", "communication", "night", "chemistry", "disease", "disk", "energy", "nation", "road", "role", "soup", "advertising", "location", "success", "addition", "apartment", "education", "math", "moment", "painting", "politics", "attention", "decision", "event", "property", "shopping", "student", "wood", "competition", "distribution", "entertainment", "office", "population", "president", "unit", "category", "cigarette", "context", "introduction", "opportunity", "performance", "driver", "flight", "length", "magazine", "newspaper", "relationship", "teaching", "cell", "dealer", "finding", "lake", "member", "message", "phone", "scene", "appearance", "association", "concept", "customer", "death", "discussion", "housing", "inflation", "insurance", "mood", "woman", "advice", "blood", "effort", "expression", "importance", "opinion", "payment", "reality", "responsibility", "situation", "skill", "statement", "wealth", "application", "city", "county", "depth", "estate", "foundation", "grandmother", "heart", "perspective", "photo", "recipe", "studio", "topic", "collection", "depression", "imagination", "passion", "percentage", "resource", "setting", "ad", "agency", "college", "connection", "criticism", "debt", "description", "memory", "patience", "secretary", "solution", "administration", "aspect", "attitude", "director", "personality", "psychology", "recommendation", "response", "selection", "storage", "version", "alcohol", "argument", "complaint", "contract", "emphasis", "highway", "loss", "membership", "possession", "preparation", "steak", "union", "agreement", "cancer", "currency", "employment", "engineering", "entry", "interaction", "mixture", "preference", "region", "republic", "tradition", "virus", "actor", "classroom", "delivery", "device", "difficulty", "drama", "election", "engine", "football", "guidance", "hotel", "owner", "priority", "protection", "suggestion", "tension", "variation", "anxiety", "atmosphere", "awareness", "bath", "bread", "candidate", "climate", "comparison", "confusion", "construction", "elevator", "emotion", "employee", "employer", "guest", "height", "leadership", "mall", "manager", "operation", "recording", "sample", "transportation", "charity", "cousin", "disaster", "editor", "efficiency", "excitement", "extent", "feedback", "guitar", "homework", "leader", "mom", "outcome", "permission", "presentation", "promotion", "reflection", "refrigerator", "resolution", "revenue", "session", "singer", "tennis", "basket", "bonus", "cabinet", "childhood", "church", "clothes", "coffee", "dinner", "drawing", "hair", "hearing", "initiative", "judgment", "lab", "measurement", "mode", "mud", "orange", "poetry", "police", "possibility", "procedure", "queen", "ratio", "relation", "restaurant", "satisfaction", "sector", "signature", "significance", "song", "tooth", "town", "vehicle", "volume", "wife", "accident", "airport", "appointment", "arrival", "assumption", "baseball", "chapter", "committee", "conversation", "database", "enthusiasm", "error", "explanation", "farmer", "gate", "girl", "hall", "historian", "hospital", "injury", "instruction", "maintenance", "manufacturer", "meal", "perception", "pie", "poem", "presence", "proposal", "reception", "replacement", "revolution", "river", "son", "speech", "tea", "village", "warning", "winner", "worker", "writer", "assistance", "breath", "buyer", "chest", "chocolate", "conclusion", "contribution", "cookie", "courage", "dad", "desk", "drawer", "establishment", "examination", "garbage", "grocery", "honey", "impression", "improvement", "independence", "insect", "inspection", "inspector", "king", "ladder", "menu", "penalty", "piano", "potato", "profession", "professor", "quantity", "reaction", "requirement", "salad", "sister", "supermarket", "tongue", "weakness", "wedding", "affair", "ambition", "analyst", "apple", "assignment", "assistant", "bathroom", "bedroom", "beer", "birthday", "celebration", "championship", "cheek", "client", "consequence", "departure", "diamond", "dirt", "ear", "fortune", "friendship", "funeral", "gene", "girlfriend", "hat", "indication", "intention", "lady", "midnight", "negotiation", "obligation", "passenger", "pizza", "platform", "poet", "pollution", "recognition", "reputation", "shirt", "sir", "speaker", "stranger", "surgery", "sympathy", "tale", "throat", "trainer", "uncle", "youth", "time", "work", "film", "water", "money", "example", "while", "business", "study", "game", "life", "form", "air", "day", "place", "number", "part", "field", "fish", "back", "process", "heat", "hand", "experience", "job", "book", "end", "point", "type", "home", "economy", "value", "body", "market", "guide", "interest", "state", "radio", "course", "company", "price", "size", "card", "list", "mind", "trade", "line", "care", "group", "risk", "word", "fat", "force", "key", "light", "training", "name", "school", "top", "amount", "level", "order", "practice", "research", "sense", "service", "piece", "web", "boss", "sport", "fun", "house", "page", "term", "test", "answer", "sound", "focus", "matter", "kind", "soil", "board", "oil", "picture", "access", "garden", "range", "rate", "reason", "future", "site", "demand", "exercise", "image", "case", "cause", "coast", "action", "age", "bad", "boat", "record", "result", "section", "building", "mouse", "cash", "class", "nothing", "period", "plan", "store", "tax", "side", "subject", "space", "rule", "stock", "weather", "chance", "figure", "man", "model", "source", "beginning", "earth", "program", "chicken", "design", "feature", "head", "material", "purpose", "question", "rock", "salt", "act", "birth", "car", "dog", "object", "scale", "sun", "note", "profit", "rent", "speed", "style", "war", "bank", "craft", "half", "inside", "outside", "standard", "bus", "exchange", "eye", "fire", "position", "pressure", "stress", "advantage", "benefit", "box", "frame", "issue", "step", "cycle", "face", "item", "metal", "paint", "review", "room", "screen", "structure", "view", "account", "ball", "discipline", "medium", "share", "balance", "bit", "black", "bottom", "choice", "gift", "impact", "machine", "shape", "tool", "wind", "address", "average", "career", "culture", "morning", "pot", "sign", "table", "task", "condition", "contact", "credit", "egg", "hope", "ice", "network", "north", "square", "attempt", "date", "effect", "link", "post", "star", "voice", "capital", "challenge", "friend", "self", "shot", "brush", "couple", "debate", "exit", "front", "function", "lack", "living", "plant", "plastic", "spot", "summer", "taste", "theme", "track", "wing", "brain", "button", "click", "desire", "foot", "gas", "influence", "notice", "rain", "wall", "base", "damage", "distance", "feeling", "pair", "savings", "staff", "sugar", "target", "text", "animal", "author", "budget", "discount", "file", "ground", "lesson", "minute", "officer", "phase", "reference", "register", "sky", "stage", "stick", "title", "trouble", "bowl", "bridge", "campaign", "character", "club", "edge", "evidence", "fan", "letter", "lock", "maximum", "novel", "option", "pack", "park", "plenty", "quarter", "skin", "sort", "weight", "baby", "background", "carry", "dish", "factor", "fruit", "glass", "joint", "master", "muscle", "red", "strength", "traffic", "trip", "vegetable", "appeal", "chart", "gear", "ideal", "kitchen", "land", "log", "mother", "net", "party", "principle", "relative", "sale", "season", "signal", "spirit", "street", "tree", "wave", "belt", "bench", "commission", "copy", "drop", "minimum", "path", "progress", "project", "sea", "south", "status", "stuff", "ticket", "tour", "angle", "blue", "breakfast", "confidence", "daughter", "degree", "doctor", "dot", "dream", "duty", "essay", "father", "fee", "finance", "hour", "juice", "limit", "luck", "milk", "mouth", "peace", "pipe", "seat", "stable", "storm", "substance", "team", "trick", "afternoon", "bat", "beach", "blank", "catch", "chain", "consideration", "cream", "crew", "detail", "gold", "interview", "kid", "mark", "match", "mission", "pain", "pleasure", "score", "screw", "sex", "shop", "shower", "suit", "tone", "window", "agent", "band", "block", "bone", "calendar", "cap", "coat", "contest", "corner", "court", "cup", "district", "door", "east", "finger", "garage", "guarantee", "hole", "hook", "implement", "layer", "lecture", "lie", "manner", "meeting", "nose", "parking", "partner", "profile", "respect", "rice", "routine", "schedule", "swimming", "telephone", "tip", "winter", "airline", "bag", "battle", "bed", "bill", "bother", "cake", "code", "curve", "designer", "dimension", "dress", "ease", "emergency", "evening", "extension", "farm", "fight", "gap", "grade", "holiday", "horror", "horse", "host", "husband", "loan", "mistake", "mountain", "nail", "noise", "occasion", "package", "patient", "pause", "phrase", "proof", "race", "relief", "sand", "sentence", "shoulder", "smoke", "stomach", "string", "tourist", "towel", "vacation", "west", "wheel", "wine", "arm", "aside", "associate", "bet", "blow", "border", "branch", "breast", "brother", "buddy", "bunch", "chip", "coach", "cross", "document", "draft", "dust", "expert", "floor", "god", "golf", "habit", "iron", "judge", "knife", "landscape", "league", "mail", "mess", "native", "opening", "parent", "pattern", "pin", "pool", "pound", "request", "salary", "shame", "shelter", "shoe", "silver", "tackle", "tank", "trust", "assist", "bake", "bar", "bell", "bike", "blame", "boy", "brick", "chair", "closet", "clue", "collar", "comment", "conference", "devil", "diet", "fear", "fuel", "glove", "jacket", "lunch", "monitor", "mortgage", "nurse", "pace", "panic", "peak", "plane", "reward", "row", "sandwich", "shock", "spite", "spray", "surprise", "till", "transition", "weekend", "welcome", "yard", "alarm", "bend", "bicycle", "bite", "blind", "bottle", "cable", "candle", "clerk", "cloud", "concert", "counter", "flower", "grandfather", "harm", "knee", "lawyer", "leather", "load", "mirror", "neck", "pension", "plate", "purple", "ruin", "ship", "skirt", "slice", "snow", "specialist", "stroke", "switch", "trash", "tune", "zone", "anger", "award", "bid", "bitter", "boot", "bug", "camp", "candy", "carpet", "cat", "champion", "channel", "clock", "comfort", "cow", "crack", "engineer", "entrance", "fault", "grass", "guy", "hell", "highlight", "incident", "island", "joke", "jury", "leg", "lip", "mate", "motor", "nerve", "passage", "pen", "pride", "priest", "prize", "promise", "resident", "resort", "ring", "roof", "rope", "sail", "scheme", "script", "sock", "station", "toe", "tower", "truck", "witness", "a", "you", "it", "can", "will", "if", "one", "many", "most", "other", "use", "make", "good", "look", "help", "go", "great", "being", "few", "might", "still", "public", "read", "keep", "start", "give", "human", "local", "general", "she", "specific", "long", "play", "feel", "high", "tonight", "put", "common", "set", "change", "simple", "past", "big", "possible", "particular", "today", "major", "personal", "current", "national", "cut", "natural", "physical", "show", "try", "check", "second", "call", "move", "pay", "let", "increase", "single", "individual", "turn", "ask", "buy", "guard", "hold", "main", "offer", "potential", "professional", "international", "travel", "cook", "alternative", "following", "special", "working", "whole", "dance", "excuse", "cold", "commercial", "low", "purchase", "deal", "primary", "worth", "fall", "necessary", "positive", "produce", "search", "present", "spend", "talk", "creative", "tell", "cost", "drive", "green", "support", "glad", "remove", "return", "run", "complex", "due", "effective", "middle", "regular", "reserve", "independent", "leave", "original", "reach", "rest", "serve", "watch", "beautiful", "charge", "active", "break", "negative", "safe", "stay", "visit", "visual", "affect", "cover", "report", "rise", "walk", "white", "beyond", "junior", "pick", "unique", "anything", "classic", "final", "lift", "mix", "private", "stop", "teach", "western", "concern", "familiar", "fly", "official", "broad", "comfortable", "gain", "maybe", "rich", "save", "stand", "young", "fail", "heavy", "hello", "lead", "listen", "valuable", "worry", "handle", "leading", "meet", "release", "sell", "finish", "normal", "press", "ride", "secret", "spread", "spring", "tough", "wait", "brown", "deep", "display", "flow", "hit", "objective", "shoot", "touch", "cancel", "chemical", "cry", "dump", "extreme", "push", "conflict", "eat", "fill", "formal", "jump", "kick", "opposite", "pass", "pitch", "remote", "total", "treat", "vast", "abuse", "beat", "burn", "deposit", "print", "raise", "sleep", "somewhere", "advance", "anywhere", "consist", "dark", "double", "draw", "equal", "fix", "hire", "internal", "join", "kill", "sensitive", "tap", "win", "attack", "claim", "constant", "drag", "drink", "guess", "minor", "pull", "raw", "soft", "solid", "wear", "weird", "wonder", "annual", "count", "dead", "doubt", "feed", "forever", "impress", "nobody", "repeat", "round", "sing", "slide", "strip", "whereas", "wish", "combine", "command", "dig", "divide", "equivalent", "hang", "hunt", "initial", "march", "mention", "smell", "spiritual", "survey", "tie", "adult", "brief", "crazy", "escape", "gather", "hate", "prior", "repair", "rough", "sad", "scratch", "sick", "strike", "employ", "external", "hurt", "illegal", "laugh", "lay", "mobile", "nasty", "ordinary", "respond", "royal", "senior", "split", "strain", "struggle", "swim", "train", "upper", "wash", "yellow", "convert", "crash", "dependent", "fold", "funny", "grab", "hide", "miss", "permit", "quote", "recover", "resolve", "roll", "sink", "slip", "spare", "suspect", "sweet", "swing", "twist", "upstairs", "usual", "abroad", "brave", "calm", "concentrate", "estimate", "grand", "male", "mine", "prompt", "quiet", "refuse", "regret", "reveal", "rush", "shake", "shift", "shine", "steal", "suck", "surround", "anybody", "bear", "brilliant", "dare", "dear", "delay", "drunk", "female", "hurry", "inevitable", "invite", "kiss", "neat", "pop", "punch", "quit", "reply", "representative", "resist", "rip", "rub", "silly", "smile", "spell", "stretch", "stupid", "tear", "temporary", "tomorrow", "wake", "wrap", "yesterday"];
            var word_lists = {'en': english_words, 'pl': polish_words}

            function getRandomInt(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
            }

            function getRemaining(c) {
                var res = 0;
                for (var idx = 0; idx < game.num_rows * game.num_cols; idx += 1) {
                    if (!game.revealed[idx] && game.type[idx] == c) {
                        res += 1;
                    }
                }
                return res;
            }

            function get_lang() {
                return $('#seed').val().split('-', 2)[0]
            }

            function recommend_needed() {
                return !game.error && game.allrevealed && game.show_recommend && get_lang() == 'en';
            }

            function hash(str) {
                var i = str.length
                var hash1 = 5381
                var hash2 = 52711

                while (i--) {
                    const char = str.charCodeAt(i)
                    hash1 = (hash1 * 33) ^ char
                    hash2 = (hash2 * 33) ^ char
                }

                return (hash1 >>> 0) * 4096 + (hash2 >>> 0)
            }


            function get_query_and_hash(color) {
                w = {r: [], b: [], n: [], e: []};
                var res = 0;
                for (var idx = 0; idx < game.num_rows * game.num_cols; idx += 1) {
                    if (!game.revealed[idx]) {
                        w[game.type[idx]].push(game.words[idx])
                    }
                }

                if (color == 'blue') {
                    var good = w.b;
                    var bad = w.r.concat(w.n);
                } else {
                    var good = w.r
                    var bad = w.b.concat(w.n);
                }
                var fail = w.e;
                if (good.length == 0) {
                    return [null, null];
                }

                var num_guesses = Math.min(good.length, parseInt(game.num_guesses));
                if (game.risk == 'allbutblack') {
                    bad = [];
                    var risk = 0;
                } else if (game.risk == 'all') {
                    bad = [];
                    fail = [];
                    var risk = 0;
                } else {
                    var risk = Math.min(parseInt(game.risk), bad.length);
                }

                function query() { return recommend(good, bad, fail, risk, num_guesses)};
                var query_hash = 'good:' + good.join(',') + ' bad:' + bad.join(',') +' fail:' + fail.join(',') +
                                 ' risk:' + risk + ' num_guesses:' + num_guesses;
                query_hash = hash(query_hash);
                return [query, query_hash];
            }

            var current_hash = {blue: null, red: null}
            function recommend_thread(color) {
                var loader = $('#recommend-' + color + '-loader');
                var text = $('#recommend-' + color);
                var wait_delay = 250;

                function invoke_self() {recommend_thread(color);}


                if (recommend_needed()) {
                    if (model === null) {
                        loader.show();
                        load_model(invoke_self);
                        return;
                    }
                    var [query, query_hash] = get_query_and_hash(color);

                    if (query_hash === null) {
                        loader.hide();
                        text.text('zero words left to guess.');
                        current_hash[color] = null;
                        setTimeout(invoke_self, wait_delay);
                        return;
                    }
                    if (current_hash[color] == query_hash) {
                        setTimeout(invoke_self, wait_delay);
                        return
                    }
                    text.text('');
                    loader.show();
                    setTimeout(function() {
                        query().then(function(value) {
                            loader.hide();
                            text.html(value.slice(0, 8).join('<br>'))
                            current_hash[color] = query_hash;
                            setTimeout(invoke_self, 0);
                        });
                    }, 10);
                } else {
                    setTimeout(invoke_self, wait_delay);
                }
            }


            function render() {
                var recommend = $('#recommend');
                var game_ui = $("#game");
                game_ui.html("");
                $('#risk').val(game.risk);
                $('#num-guesses').val(game.num_guesses);
                if (game.error) {
                    var p = $('<p class="lead" \>');
                    p.html(game.error);
                    game_ui.append(p);
                    recommend.collapse('hide');
                } else {
                    table = $('<table class="table-style" />');
                    $('#spymaster-li').removeClass();
                    if (game.allrevealed) {
                        $('#spymaster-li').addClass("active");
                    }
                    if (game.show_recommend) {
                        $('#intro-recommend').hide();
                        $('#recommend-settings').show()
                    } else {
                        $('#intro-recommend').show();
                        $('#recommend-settings').hide()
                    }
                    for (var i=0; i < game.num_rows; i+=1) {
                        var row = $("<tr>")
                        for (var j=0; j < game.num_cols; j+=1) {
                            var idx = i * game.num_cols + j;
                            var cell = $("<td>")
                            cell.addClass("cell");
                            if (game.revealed[idx] || game.allrevealed) {
                                cell.addClass("cell-revealed");
                                if (game.type[idx] === "r") {
                                    cell.addClass("cell-red");
                                } else if (game.type[idx] === "b") {
                                    cell.addClass("cell-blue");
                                } else if (game.type[idx] === "n") {
                                    cell.addClass("cell-neutral");
                                } else if (game.type[idx] === "e") {
                                    cell.addClass("cell-end");
                                }
                                if (game.revealed[idx] && game.allrevealed) {
                                    cell.addClass("cell-strike");
                                }
                            } else {
                                cell.addClass("cell-inrevealed");
                            }
                            cell.dblclick(function(inner) { return function() { toggle_reveal(inner); }}(idx));
                            cell.on('touchend', function(inner) { return function() { toggle_reveal(inner); }}(idx));
                            var word = $("<span>");

                            word.text(game.words[idx])
                            word.addClass("cell-text")
                            cell.append(word);
                            row.append(cell);
                        }
                        table.append(row);
                    }
                    game_ui.append(table);
                    $('#red-left').text(getRemaining("r"));
                    $('#blue-left').text(getRemaining("b"));
                    if (recommend_needed()) {
                        recommend.addClass('d-none');
                        recommend.addClass('d-sm-block');
                        recommend.collapse('show');
                    } else {
                        recommend.collapse('hide');
                        recommend.removeClass('d-none');
                        recommend.removeClass('d-sm-block');
                    }
                    if (get_lang() == 'en') {
                        $('#recommend-lang-warning').hide();
                    } else {
                        $('#recommend-lang-warning').show();
                    }
                }
                sessionStorage.setItem("game", JSON.stringify(game));
            }

            function toggle_reveal(idx) {
                game.revealed[idx] = !game.revealed[idx];
                render();
            }

            function toggle_spymaster() {
                game.allrevealed = !game.allrevealed;
                render();
            }

            function enable_recommend() {
                game.show_recommend = true;
                if (!game.allrevealed) {
                    game.allrevealed = true;
                }
                render();
            }

            function disable_recommend() {
                game.show_recommend = false;
                render();
            }

            function set_from_seed() {
                var seed = $('#seed').val().split('-', 2);
                sessionStorage.setItem("seed", JSON.stringify($('#seed').val()));

                game.error = null;
                if (seed.length != 2) {
                    game.error = "Seed must be of form <mark>lang</mark>-<mark>phrase</mark>, where <mark>lang</mark> is the language and <mark>phrase</mark> defines the board.";
                    render(); return;
                }
                var lang = seed[0];
                var seed = seed[1];
                if (!word_lists[lang]) {
                    game.error = "Language must be one of " + Object.keys(word_lists).sort().join(', ') + ".";
                    render(); return;
                }
                allwords = word_lists[lang];

                total = game.num_rows * game.num_cols;
                nthings = Math.floor(total / 3);
                game.type = [];
                for (var i = 0; i < nthings; i += 1) {
                    game.type.push("r");
                    game.type.push("b");
                }
                if (getRandomInt(0, 2) === 0) {
                    game.type.push("r");
                } else {
                    game.type.push("b");
                }
                game.type.push("e");
                for (var i = 0; i < total - (2 * nthings + 2); i += 1) {
                    game.type.push("n");
                }
                game.type = seeded_shuffle.shuffle(game.type, seed, true);

                game.revealed = [];
                for (var idx = 0; idx < game.num_rows * game.num_cols; idx += 1) { game.revealed.push(0); }
                game.words = seeded_shuffle.shuffle(allwords, seed, true).slice(0, total);
                render();
            }

            alphabet = "abcdefghijklmnopqrstuvwxyz"

            function int_to_string(seed) {
                var res = "";
                while (seed > 0) {
                    res += alphabet[seed % alphabet.length];
                    seed = Math.floor(seed / alphabet.length);
                }
                return res;
            }

            function reset(event) {
                var lang = "en";
                if (event) {
                    lang = $(event.toElement).attr("data-language");
                }
                console.log(lang);
                seed = getRandomInt(0, 1e9);
                seed_str = lang + "-" + int_to_string(seed);
                $('#seed').val(seed_str);
                set_from_seed();
            }

            function update_risk() {
                game.risk = $('#risk').val();
                render()
            }

            function update_num_guesses() {
                game.num_guesses = $('#num-guesses').val();
                render();
            }

            var current_version = 2;

            function verify_storage() {
                var stored_version = sessionStorage.getItem('storage_version')
                if (stored_version < current_version) {
                    indexedDB.deleteDatabase('d2');
                    sessionStorage.clear();
                    sessionStorage.setItem('storage_version', current_version);
                    if (stored_version !== null) {
                        alert('Website was updated to new version! Deleting your old settings.')
                    }
                }
            }

            $(document).ready(function() {
                verify_storage();
                if (!('ontouchstart' in document.documentElement)) {
                     $('[data-toggle="tooltip"]').tooltip();
                }
                $("#spymaster").click(toggle_spymaster);
                $('#enable-recommend').click(enable_recommend);
                $('#disable-recommend').click(disable_recommend);
                $(".reset-button").click(reset);
                $("#seed").val(seed);
                $("#seed").keyup(set_from_seed);
                $("#risk").change(update_risk);
                $("#num-guesses").change(update_num_guesses);

                if (sessionStorage.getItem("game")) {
                    seed = JSON.parse(sessionStorage.getItem("seed"));
                    $('#seed').val(seed);
                    game = JSON.parse(sessionStorage.getItem("game"));
                    render();
                } else {
                    reset();
                }
                recommend_thread('red');
                recommend_thread('blue');
                $('#fullscreen').click(function() {
                    console.log("requesting fullscreen")
                    $('body')[0].requestFullscreen();
                });
            });
        </script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-102294427-1', 'auto');
          ga('send', 'pageview');
        </script>
    </body>
</html>
